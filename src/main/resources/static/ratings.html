<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Ratings Analysis</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
</head>
<body>
    <header>
        <h1>Customer Ratings Analysis</h1>
    </header>

    <div class="filters-container">
        <form id="filterForm">
            <div class="filter-block">
                <h2>Age Range</h2>
                <label for="ageMin">Min Age:</label>
                <input type="number" id="ageMin" name="ageMin" min="0">
                <label for="ageMax">Max Age:</label>
                <input type="number" id="ageMax" name="ageMax">
            </div>
    
            <div class="filter-block">
                <h2>Gender</h2>
                <select id="gender" name="gender">
                    <option value="">All</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="diverse">Diverse</option>
                </select>
            </div>
    
            <div class="filter-block">
                <h2>Time Frame</h2>
                <label for="yearStart">Start Year:</label>
                <input type="number" id="yearStart" name="yearStart" min="2000" max="2099">
                <label for="yearEnd">End Year:</label>
                <input type="number" id="yearEnd" name="yearEnd" min="2000" max="2099">
            </div>
    
            <button type="button" onclick="updateChart()">Generate</button>
        </form>
    </div>

    <div id="chartContainer1" style="height: 300px; width: 100%;"></div>
    <div id="chartContainer2" style="height: 300px; width: 100%;"></div>

    <div id="dataDisplay" style="margin-top: 20px;">
        <h2>Review Data:</h2>
        <ul id="reviewList"></ul>
    </div>

    <script>
        function updateChart() {
            const ageMin = document.getElementById('ageMin').value;
            const ageMax = document.getElementById('ageMax').value;
            const gender = document.getElementById('gender').value;
            const yearStart = document.getElementById('yearStart').value;
            const yearEnd = document.getElementById('yearEnd').value;
        
            fetch(`/portal_service/api/analytics/visitor-reviews?` + new URLSearchParams({
                ageMin: ageMin,
                ageMax: ageMax,
                gender: gender,
                yearStart: yearStart,
                yearEnd: yearEnd
            }))
            .then(response => response.json())
            .then(data => {
                displayData(data);
            })
            .catch(error => console.error('Error fetching visitor reviews:', error));
        }
        
        function displayData(data) {
            const list = document.getElementById('reviewList');
            list.innerHTML = '';
            if (data.length > 0) {
                data.forEach(review => {
                    const item = document.createElement('li');
                    item.textContent = `Rating: ${review.rating}, Date: ${review.visitTime}, Gender: ${review.gender}, Age: ${review.age}`;
                    list.appendChild(item);
                });
            } else {
                list.innerHTML = '<li>No data found for the selected filters.</li>';
            }
        }
    </script>
</body>
</html>
